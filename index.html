<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer">
    <title>CANOFLIX PRO</title>
    <link href="https://vjs.zencdn.net/7.20.3/video-js.css" rel="stylesheet" />
    <style>
        :root { --main: #e50914; --bg: #0b0b0b; --card: #1a1a1a; }
        body { background: var(--bg); color: #fff; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        /* Sol Menü */
        .sidebar { width: 240px; background: #000; display: flex; flex-direction: column; border-right: 1px solid #333; transition: 0.3s; }
        .logo { padding: 30px; font-size: 24px; font-weight: bold; color: var(--main); text-align: center; border-bottom: 1px solid #222; }
        .menu-list { flex: 1; overflow-y: auto; padding: 20px 0; }
        .menu-item { padding: 12px 25px; cursor: pointer; color: #b3b3b3; transition: 0.3s; font-size: 14px; }
        .menu-item:hover, .menu-item.active { background: #222; color: #fff; border-left: 4px solid var(--main); }

        /* Sağ İçerik Alanı */
        .main-content { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
        header { padding: 20px 40px; background: rgba(0,0,0,0.5); display: flex; justify-content: space-between; align-items: center; }
        .search-bar { background: #222; border: none; padding: 10px 20px; border-radius: 20px; color: #fff; width: 300px; outline: none; }

        /* Film Grid */
        #movie-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 20px; padding: 40px; overflow-y: auto; align-content: flex-start; }
        .movie-card { background: var(--card); border-radius: 8px; overflow: hidden; transition: 0.3s; cursor: pointer; position: relative; }
        .movie-card:hover { transform: translateY(-10px); box-shadow: 0 10px 20px rgba(0,0,0,0.5); }
        .movie-card img { width: 100%; height: 240px; object-fit: cover; }
        .movie-info { padding: 10px; font-size: 12px; text-align: center; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* Fullscreen Player Modal */
        #player-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; display: none; z-index: 2000; flex-direction: column; }
        .close-player { position: absolute; top: 20px; right: 30px; font-size: 40px; cursor: pointer; z-index: 2100; color: #fff; text-shadow: 0 0 10px #000; }
        .video-container { flex: 1; display: flex; align-items: center; justify-content: center; }
        .video-js { width: 100% !important; height: 100% !important; }

        @media (max-width: 768px) {
            .sidebar { width: 0; position: absolute; left: -240px; }
            .search-bar { width: 150px; }
        }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="logo">CANOFLIX</div>
    <div id="category-menu" class="menu-list">
        <div class="menu-item active" onclick="filtrele('Tümü')">Ana Sayfa</div>
        </div>
</div>

<div class="main-content">
    <header>
        <input type="text" class="search-bar" id="searchInput" placeholder="Film veya dizi ara..." onkeyup="aramaYap()">
        <div id="status">Yükleniyor...</div>
    </header>

    <div id="movie-grid">
        </div>
</div>

<div id="player-modal">
    <span class="close-player" onclick="kapatPlayer()">&times;</span>
    <div class="video-container">
        <video id="my-video" class="video-js vjs-big-play-centered" controls preload="auto" referrerpolicy="no-referrer"></video>
    </div>
</div>

<script src="https://vjs.zencdn.net/7.20.3/video.min.js"></script>
<script>
    let filmler = [];
    const player = videojs('my-video');

    // 1. Veriyi Çek
    async function veriyiGetir() {
        try {
            const response = await fetch('filmler.json');
            filmler = await response.json();
            document.getElementById('status').innerText = filmler.length + " İçerik";
            
            kategorileriBas();
            izgarayıBas(filmler);
        } catch (e) {
            document.getElementById('status').innerText = "Hata: JSON bulunamadı!";
        }
    }

    // 2. Kategorileri Menüye Bas
    function kategorileriBas() {
        const menu = document.getElementById('category-menu');
        const kategoriler = [...new Set(filmler.map(f => f.kategori || "Diğer"))];
        
        kategoriler.forEach(kat => {
            const div = document.createElement('div');
            div.className = 'menu-item';
            div.innerText = kat;
            div.onclick = () => {
                document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
                div.classList.add('active');
                filtrele(kat);
            };
            menu.appendChild(div);
        });
    }

    // 3. Kartları Ekrana Bas
    function izgarayıBas(liste) {
        const grid = document.getElementById('movie-grid');
        grid.innerHTML = '';
        
        // Performans için ilk 200 tanesini göster (Scroll yaptıkça artırılabilir)
        liste.slice(0, 200).forEach(film => {
            const card = document.createElement('div');
            card.className = 'movie-card';
            card.onclick = () => oynat(film.link);
            
            card.innerHTML = `
                <img src="${film.resim}" onerror="this.src='https://via.placeholder.com/160x240/1a1a1a/ffffff?text=${film.tip}'" loading="lazy">
                <div class="movie-info">${film.baslik}</div>
            `;
            grid.appendChild(card);
        });
    }

    // 4. Arama Fonksiyonu
    function aramaYap() {
        const kelime = document.getElementById('searchInput').value.toLowerCase();
        const sonuclar = filmler.filter(f => f.baslik.toLowerCase().includes(kelime));
        izgarayıBas(sonuclar);
    }

    // 5. Filtreleme
    function filtrele(kat) {
        if(kat === 'Tümü') izgarayıBas(filmler);
        else {
            const sonuclar = filmler.filter(f => f.kategori === kat);
            izgarayıBas(sonuclar);
        }
    }

    // 6. Oynatıcıyı Aç
    function oynat(link) {
        const modal = document.getElementById('player-modal');
        modal.style.display = 'flex';
        
        player.src({
            src: link,
            type: 'application/x-mpegURL'
        });
        player.play();
    }

    // 7. Oynatıcıyı Kapat
    function kapatPlayer() {
        player.pause();
        document.getElementById('player-modal').style.display = 'none';
    }

    window.onload = veriyiGetir;
</script>
</body>
</html>
